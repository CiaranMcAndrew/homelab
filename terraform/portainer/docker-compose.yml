services:
  portainer-terraform-job:
    build:
      context: ../../agents/terraform
      dockerfile: Dockerfile
    restart: no
    container_name: terraform_agent
    network_mode: host
    volumes:
      - ./:/terraform:ro
      - ../../.env:/.env:ro
      - /root/.ssh/id_rsa.pub:/root/.ssh/id_rsa.pub:ro
      - /etc/resolv.conf:/etc/resolv.conf:ro
    working_dir: /terraform
    env_file: 
      - .env
    environment:
      TF_VAR_portainer_admin_password: "${PORTAINER_ADMIN_PASSWORD}"
      TF_VAR_portainer_api_key: "${PORTAINER_API_KEY}"
      TF_VAR_gitlab_token: "${GITLAB_TOKEN}"
      TF_VAR_sonarr_api_key: "${SONARR_API_KEY}"
      TF_VAR_radarr_api_key: "${RADARR_API_KEY}"
      TF_VAR_prowlarr_api_key: "${PROWLARR_API_KEY}"
      TF_VAR_jellyfin_api_key: "${JELLYFIN_API_KEY}"
      TF_VAR_pihole_webpassword: "${PIHOLE_WEBPASSWORD}"
      TF_VAR_wireguard_password: "${WIREGUARD_PASSWORD}"
      TF_VAR_wireguard_private_key: "${WIREGUARD_PRIVATE_KEY}"
      TF_VAR_proton_username: "${PROTON_USERNAME}"
      TF_VAR_proton_password: "${PROTON_PASSWORD}"
      TF_VAR_qbittorrent_password: "${QBITTORRENT_PASSWORD}"
      TF_VAR_proxmox_token_id: "${PROXMOX_TOKEN_ID}"
      TF_VAR_proxmox_token_secret: "${PROXMOX_TOKEN_SECRET}"
      TF_CLI_ARGS: "-var-file=environment/${TF_ENV:-homelab}.tfvars"  