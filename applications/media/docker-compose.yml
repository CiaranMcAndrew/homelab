services:

  jellyfin:
    image: lscr.io/linuxserver/jellyfin:latest
    container_name: jellyfin
    labels:
      homepage.group: Media
      homepage.name: jellyfin
      homepage.icon: jellyfin.png
      homepage.description: Media server
      homepage.href: http://jellyfin.lab
      homepage.weight: 0
      homepage.widget.type: jellyfin
      homepage.widget.url: http://jellyfin.lab
      homepage.widget.key: ${JELLYFIN_API_KEY}

      traefik.enable: true
      traefik.http.routers.jellyfin.rule: Host(`jellyfin.lab`)
      traefik.http.routers.jellyfin.entrypoints: web
      traefik.http.services.jellyfin.loadbalancer.server.url: http://jellyfin:8096
    networks:
      - traefik-network
    ports:
      - "7359:7359/udp"
      - "1900:1900/udp"
    volumes:
      - jellyfin-config:/config
      - jellyfin-data:/data
    env_file:
      - /opt/homelab/.env

  sonarr:
    image: lscr.io/linuxserver/sonarr
    container_name: sonarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TIMEZONE}
    volumes:
      - sonarr-config:/config
      - sonarr-data:/data
    restart: always
    healthcheck:
      test: ["CMD", "curl", "--fail", "http://127.0.0.1:8989/ping"]
      interval: 1m
      retries: 10
    labels:
      traefik.enable: true
      traefik.http.routers.sonarr.rule: Host(`sonarr.lab`)
      traefik.http.routers.sonarr.entrypoints: web
      # traefik.http.services.jellyfin.loadbalancer.server.url: http://jellyfin:8096
      traefik.http.services.sonarr.loadbalancer.server.port: 8989
      homepage.group: Media
      homepage.name: Sonarr
      homepage.icon: sonarr.png
      homepage.href: http://sonarr.lab
      homepage.description: Series management
      homepage.weight: 0
      homepage.widget.type: sonarr
      homepage.widget.url: http://sonarr.lab
      homepage.widget.key: ${SONARR_API_KEY}
    networks:
      - traefik-network

  radarr:
    image: lscr.io/linuxserver/radarr
    container_name: radarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TIMEZONE}
    volumes:
      - radarr-config:/config
      - radarr-data:/data
    restart: always
    healthcheck:
      test: ["CMD", "curl", "--fail", "http://127.0.0.1:7878/ping"]
      interval: 1m
      retries: 10
    labels:
      traefik.enable: true
      traefik.http.routers.radarr.rule: Host(`radarr.lab`)
      traefik.http.routers.radarr.entrypoints: web
      traefik.http.services.radarr.loadbalancer.server.port: 7878
      homepage.group: Media
      homepage.name: Radarr
      homepage.icon: radarr.png
      homepage.href: http://radarr.lab
      homepage.description: Movies management
      homepage.weight: 1
      homepage.widget.type: radarr
      homepage.widget.url: http://radarr.lab
      homepage.widget.key: ${RADARR_API_KEY}
    networks:
      - traefik-network
networks:
  traefik-network:
    external: true

prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID=1000
      - PGID=100
      - TZ=${TIMEZONE}
    volumes:
      - prowlarr-config:/config
    restart: always
    healthcheck:
      test: ["CMD", "curl", "--fail", "http://127.0.0.1:9696/ping"]
      interval: 1m
      retries: 10
    labels:
      traefik.enable: true
      traefik.http.routers.prowlarr.rule: Host(`prowlarr.lab`)
      traefik.http.services.prowlarr.loadbalancer.server.port: 9696
      homepage.group: Media
      homepage.name: Prowlarr
      homepage.icon: prowlarr.png
      homepage.href: http://prowlarr.lab
      homepage.description: Indexers management
      homepage.weight: 1
      homepage.widget.type: prowlarr
      homepage.widget.url: http://prowlarr.lab
      homepage.widget.key: ${PROWLARR_API_KEY}
    networks:
      - traefik-network

volumes:
  jellyfin-config:
  jellyfin-data:
    external: true
  sonarr-config:
  sonarr-data:
  radarr-config:
  radarr-data:
  prowlarr-config:
  prowlarr-data: